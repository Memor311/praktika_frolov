<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  <title>{% block title %}Мой сайт{% endblock %}</title>
    <link rel="icon" href="/media/favicon.ico" type="image/x-icon">
  {% load static %}
  <link rel="stylesheet" href="{% static 'style.css' %}">
</head>

<body class="d-flex flex-column min-vh-100" style="background-color: #dbdbdb;">

  <header>
    <nav class="navbar navbar-expand-lg bg-danger-darker border-bottom border-body mb-2">
      <div class="container-fluid">
        <!-- Логотип / Название -->
        <a class="navbar-brand" href="/">ЦВЕТОЧНЫЙ МАГАЗИН</a>

        <div class="collapse navbar-collapse" id="navbarNav">
          <!-- Левое меню -->
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link" href="{% url 'catalog' %}">Каталог</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Процесс заказа</a>
            </li>
          </ul>

          <!-- Правое меню: авторизация + админка -->
          <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
            {% if user.is_authenticated %}
            <li class="nav-item ms-2">
              <form method="post" action="{% url 'logout' %}" class="d-inline">
                {% csrf_token %}
                <button type="submit" class="btn btn-link nav-link p-0 text-decoration-none">
                  Выйти
                </button>
              </form>
            </li>
            {% else %}
            <li class="nav-item ms-2">
              <a class="nav-link p-0 text-decoration-none" href="{% url 'login' %}">Войти</a>
            </li>
            {% endif %}

            <!-- Админ-панель только для администраторов -->
            {% if user.is_authenticated and user.role.name == 'Администратор' %}
            <li class="nav-item ms-2">
              <a class="nav-link p-0 text-decoration-none" href="{% url 'admin-panel' %}">Админ-панель</a>
            </li>
            {% endif %}

             {% if user.is_authenticated and user.role.name == 'Администратор' %}
            <li class="nav-item ms-2">
              <a class="nav-link p-0 text-decoration-none" href="{% url 'sales-report' %}">Отчёт по продажам</a>
            </li>
            {% endif %}

            <!-- Корзина -->
            <li class="nav-item mb-2 mb-lg-0 ms-2">
              {% with cart_count=request.session.cart|length %}
              <a href="{% url 'cart' %}" class="nav-link text-dark p-0 text-decoration-none">
                Корзина
                {% if cart_count > 0 %}
                <span class="badge bg-danger">{{ cart_count }}</span>
                {% endif %}
              </a>
              {% endwith %}
            </li>

            <!-- Профиль -->
            {% if user.is_authenticated %}
            <li class="nav-item ms-2">
              <a href="{% url 'profile' %}" class="nav-link ml-1 text-dark p-0 text-decoration-none">Профиль</a>
            </li>
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>
  </header>

  {% if messages %}
    <div class="container mt-3">
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    </div>
  {% endif %}
  <!-- Основной контент (будет меняться) -->
  <main class="flex-grow-1">
    {% block content %}
    {% endblock %}
  </main>

  <!-- Подвал -->
  <footer class="mt-auto bg-light py-3 border-top">
    <div class="container text-center">
      <p class="mb-0">&copy; 2026 Мой сайт. Все права защищены.</p>
    </div>
  </footer>

</body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>

</html>