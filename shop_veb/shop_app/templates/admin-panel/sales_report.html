{% extends 'base.html' %}

{% block title %}–û—Ç—á—ë—Ç –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1>üìä –û—Ç—á—ë—Ç –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º</h1>
    <a href="?export=xlsx" class="btn btn-primary">üì• –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</a>
  </div>

  <!-- –§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ -->
  <div class="card mb-4">
    <div class="card-body">
      <h5>–§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ</h5>
      <form method="get" class="row g-3">
        <div class="col-md-3">
          <label class="form-label">–°</label>
          <input type="date" name="date_from" value="{% if date_from %}{{ date_from }}{% endif %}" class="form-control">
        </div>
        <div class="col-md-3">
          <label class="form-label">–ü–æ</label>
          <input type="date" name="date_to" value="{% if date_to %}{{ date_to }}{% endif %}" class="form-control">
        </div>
        <div class="col-md-2">
          <button type="submit" class="btn btn-success mt-4">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
        </div>
        {% if date_from or date_to %}
          <div class="col-md-2">
            <a href="{% url 'sales-report' %}" class="btn btn-secondary mt-4">–°–±—Ä–æ—Å–∏—Ç—å</a>
          </div>
        {% endif %}
      </form>
    </div>
  </div>

  <!-- –¢–∞–±–ª–∏—Ü–∞ -->
  <div class="table-responsive">
    <table class="table table-hover">
      <thead class="table-light">
        <tr>
          <th>#</th>
          <th>–¢–æ–≤–∞—Ä</th>
          <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
          <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
          <th>–ó–∞–∫–∞–∑–æ–≤</th>
          <th>–°—Ä–µ–¥–Ω–µ–µ –≤ –∑–∞–∫–∞–∑–µ</th>
          <th>–°—É–º–º–∞ (‚ÇΩ)</th>
        </tr>
      </thead>
      <tbody>
        {% for item in report %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ item.product_name }}</td>
            <td>{{ item.category_name }}</td>
            <td>{{ item.total_quantity }}</td>
            <td>{{ item.order_count }}</td>
            <td>{{ item.avg_per_order|floatformat:2 }}</td>
            <td>{{ item.total_revenue|floatformat:2 }} ‚ÇΩ</td>
          </tr>
        {% empty %}
          <tr><td colspan="7" class="text-center text-muted">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}